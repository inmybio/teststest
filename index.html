<!DOCTYPE html>
<html>
<head>
<title>Seamless Video Randomizer (Single Group + Drag-Drop)</title>
<style>
    body{ background:#111; color:#fff; font-family:Arial; text-align:center; }
    h2{margin-top:40px;}
    #dropzone{
        width:80%; margin:auto; padding:40px; border:3px dashed #555;
        border-radius:10px; font-size:18px; color:#ccc;
    }
    #dropzone.dragover{ border-color:#0f0; color:#0f0; }
    button{ padding:10px 20px; font-size:18px; margin-top:25px; cursor:pointer; }
    video{
        position:absolute; top:50%; left:50%;
        transform:translate(-50%, -50%);
        width:70%; background:black;
    }
</style>
</head>
<body>

<h2>Drag & Drop Videos Below</h2>
<div id="dropzone">Drop videos here</div>

<button onclick="startLoop()">Start</button>
<button onclick="stopLoop()">Stop</button>

<video id="v1" preload="auto"></video>
<video id="v2" preload="auto"></video>

<script>
let videos = [];   // storage
let playing = false;

let v1 = document.getElementById("v1");
let v2 = document.getElementById("v2");
let active = v1;
let nextVid = v2;

// Drag & Drop Handling
const box = document.getElementById("dropzone");

box.ondragover = e => { e.preventDefault(); box.classList.add("dragover"); };
box.ondragleave = () => box.classList.remove("dragover");

box.ondrop = e =>{
    e.preventDefault(); box.classList.remove("dragover");
    for(let f of e.dataTransfer.files){
        if(f.type.includes("video")) videos.push(URL.createObjectURL(f));
    }
    box.textContent = videos.length+" video(s) loaded";
};

function startLoop(){
    if(videos.length < 1){ alert("Drop at least one video"); return; }
    playing = true;
    playCycle();
}

function stopLoop(){
    playing = false;
    v1.pause(); v2.pause();
}

async function playCycle(){
    while(playing){
        shuffle(videos);

        for(let file of videos){
            if(!playing) return;
            await seamlessPlay(file);
        }
    }
}

function seamlessPlay(src){
    return new Promise(resolve=>{

        nextVid.src = src;
        nextVid.load();

        nextVid.oncanplay = ()=>{
            active.pause();
            nextVid.play();

            [active,nextVid] = [nextVid,active];

            active.onended = ()=>resolve();
        };
    });
}

function shuffle(a){
    for(let i=a.length-1;i>0;i--){
        let j=Math.random()* (i+1) | 0;
        [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
}
</script>

</body>
</html>
