<!DOCTYPE html>
<html>
<head>
<title>Video Randomizer Player</title>
<style>
    body{ background:#111; color:#fff; font-family:Arial; text-align:center; }
    input{ margin:5px; width:80%; padding:8px; }
    button{ padding:10px 20px; font-size:18px; margin:12px; cursor:pointer; }
    video{ width:70%; margin-top:20px; background:black; }
</style>
</head>
<body>

<h2>Upload First 3 Videos (Group A)</h2>
<input type="file" accept="video/*" id="gA1"><br>
<input type="file" accept="video/*" id="gA2"><br>
<input type="file" accept="video/*" id="gA3"><br>

<h2>Upload Second 3 Videos (Group B)</h2>
<input type="file" accept="video/*" id="gB1"><br>
<input type="file" accept="video/*" id="gB2"><br>
<input type="file" accept="video/*" id="gB3"><br>

<button onclick="startLoop()">Start Loop</button>
<button onclick="stopLoop()">Stop</button>

<video id="player" controls autoplay></video>

<script>
let groupA = [];
let groupB = [];
let playing = false;
let player = document.getElementById("player");

function startLoop(){
    groupA = getFiles(["gA1","gA2","gA3"]);
    groupB = getFiles(["gB1","gB2","gB3"]);

    if(groupA.length < 3 || groupB.length < 3){
        alert("Upload 3 videos in each group first");
        return;
    }

    playing = true;
    playCycle();
}

function stopLoop(){
    playing = false;
    player.pause();
}

function getFiles(ids){
    return ids.map(id => {
        let file = document.getElementById(id).files[0];
        return file ? URL.createObjectURL(file) : null;
    }).filter(v=>v);
}

// Plays A1-A2-A3 in random order then one video from B
async function playCycle(){
    while(playing){
        let aRandom = shuffle([...groupA]);
        for(let vid of aRandom){
            if(!playing) return;
            await playVideo(vid);
        }

        let bVid = groupB[Math.floor(Math.random()*groupB.length)];
        if(!playing) return;
        await playVideo(bVid);
    }
}

// Promise-based video playback
function playVideo(src){
    return new Promise(resolve=>{
        player.src = src;
        player.onended = ()=>resolve();
        player.play();
    });
}

// Fisher-Yates shuffle
function shuffle(arr){
    for(let i = arr.length-1; i>0; i--){
        let j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
}
</script>

</body>
</html>
